<script>
  const CONFIG_URL = "https://iting0901.github.io/noreservation/config.json";
  const output = document.getElementById("output");

  function log(msg) {
    console.log(msg);
    output.textContent += "\n" + msg;
  }

  async function loadConfig() {
    const res = await fetch(CONFIG_URL, { cache: "no-store" });
    if (!res.ok) throw new Error("config.json 讀不到：" + res.status);
    return await res.json();
  }

  function extractJsonFromHtml(htmlText) {
    const match = htmlText.match(/<pre id="payload">([\s\S]*?)<\/pre>/);
    if (!match) throw new Error("GAS 回傳格式不對（找不到 payload）");
    return JSON.parse(match[1]);
  }

  async function callGas(url) {
    const res = await fetch(url, { cache: "no-store" });
    if (!res.ok) throw new Error("GAS 讀不到：" + res.status);
    const htmlText = await res.text();
    return extractJsonFromHtml(htmlText);
  }

  async function main() {
    log("開始讀取 config.json ...");
    const cfg = await loadConfig();
    log("config OK");

    log("呼叫 GAS 1...");
    const gas1 = await callGas(cfg.scriptUrl1);
    log("GAS 1：" + JSON.stringify(gas1));

    log("呼叫 GAS 2...");
    const gas2 = await callGas(cfg.scriptUrl2);
    log("GAS 2：" + JSON.stringify(gas2));

    log("全部完成 ✅");
  }

  main().catch(err => {
    console.error(err);
    output.textContent = "❌ 錯誤：\n" + err.message;
    alert(err.message);
  });
</script>
